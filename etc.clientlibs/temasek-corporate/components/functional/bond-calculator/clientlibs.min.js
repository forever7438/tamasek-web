jQuery(function(b){function y(a){a=a.getDay();return a===t.Weekday.SUNDAY||a===t.Weekday.SATURDAY}function z(a){a=a.split(" ");var c=k.numberFromName(a[1]);return a[0]+"/"+c+"/"+a[2]}function l(a){return a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function r(a,c){return c>a?"yes":c<a?"no":"same"}function G(a){var c=!1;a=a||new Date;a.setHours(0,0,0,0);var b=a.getTime();jQuery.each(H,function(a,f){a=f.holidayDate.split(" ");f=k.indexFromName(a[1]);a=(new Date(a[2],f,a[0])).getTime();return b===
a?(c=!0,!1):!0});return c}function w(a){b("#"+a).parent().find(".update-date").hide()}function A(a,c){b("#"+a).parent().find(".lastUpdated").text(c);b("#"+a).parent().find(".update-date").show()}function B(a,c){m.show();var f=n.data("bond-year");jQuery.getJSON("/bin/public/temasek-corporate/bond_information.json?bondYear\x3d"+f).done(function(f){d.bondInfo=f.bond_info;f=d.bondInfo.last_updated;var e=new Date,g=e.getHours(),q=p.parseInt(f.slice(9,11),10);e=f=(y(e)||G()||17<=g||9>=g||g===q?f:f.split(" ")[0]+
" "+g+":00").split(" ");q=f[0];g=q.slice(6,8);var h=p.parseInt(q.slice(4,6),10);h=k.nameFromNumber(h);q=q.slice(0,4);e[0]=g+" "+h+" "+q;f=f.join(" ");d.buyPriceDefault="-"===d.bondInfo.sell_price?d.bondInfo.buy_price:d.bondInfo.sell_price;"#tabBuying"===a?(b("#"+c).val(d.buyPriceDefault).addClass("has-value"),A(c,f)):(e=b("#"+c).attr("data-is-dirty"),"sellingPurchasePricePerLot"!==c?"true"!==e&&(b("#"+c).val(d.buyPriceDefault).addClass("has-value"),A(c,f)):(d.sellPriceDefault="-"===d.bondInfo.buy_price?
d.bondInfo.sell_price:d.bondInfo.buy_price,"true"!==e&&(b("#"+c).val(d.sellPriceDefault).addClass("has-value"),A(c,f))));m.hide()}).fail(function(a){"abort"!==a.statusText&&m.hide()})}function M(a){var c=u.filter(I,function(c){return a===c.Date});if(c.length)return c[c.length-1]}function C(a,c){a=String(b("#"+a).val());a=a.split(" ");var f=k.numberFromName(a[1]);a=a[2]+"-"+J.padStart(String(f),2,"0")+"-"+a[0];(a=M(a))?b("#"+c).val(a.Close).addClass("has-value"):b("#"+c).val("").removeClass("has-value");
w(c)}function N(a){var c=[],b;u.forEach(a.split("\n"),function(a,f){var d=a.split(",");if(0===f)b=d;else{var e={};u.forEach(b,function(a,c){e[a]=d[c]});c.push(e)}});return c}function D(a){return y(a)||G(a)}function O(a,c){var b=!1;a=a.split(" ");var d=k.indexFromName(a[1]),e=new Date(a[2],d,p.parseInt(a[0],10));e.setDate(e.getDate()+c);if(y(e))return!0;jQuery.each(H,function(a,c){a=c.holidayDate.split(" ");c=k.indexFromName(a[1]);a=new Date(a[2],c,a[0]);return e.getTime()===a.getTime()?(b=!0,!1):
!0});return b}function x(a){for(var c=1,b=1,d;2>=c;)(d=O(a,b))||(c+=1),b+=1;a=a.split(" ");c=k.indexFromName(a[1]);a=new Date(a[2],c,p.parseInt(a[0],10));a.setDate(a.getDate()+(b-1));b=k.numberFromIndex(a.getMonth());return a.getDate()+"/"+b+"/"+a.getFullYear()}function P(a,c){if(c.value)return a;b(c).addClass("error");return!1}function K(a){b(a).find(".error").removeClass("error");b(".error-msg").hide();var c=b(a).find("input");if(!u.reduce(c,P,!0))return!1;c=!0;var f=b(a).find(".number-of-lots").val(),
d=b(a).find(".purchase-price-per-lot").val();"0"===f&&(b(a).find(".number-of-lots").addClass("error"),c=!1);"0"===d&&(b(a).find(".purchase-price-per-lot").addClass("error"),c=!1);if("#tabSelling"===a){a=b("#sellingSellPricePerLot").val();var e=b("#sellingPurchaseDate").val();d=b("#sellingSaleDate").val();f=new Date(e);d=new Date(d);e=x(e).split("/");var g=p.parseInt(e[1],10);g=k.nameFromNumber(g);e=e[0]+" "+g+" "+e[2];e=new Date(e);"0"===a&&(b("#sellingSellPricePerLot").addClass("error"),c=!1);"yes"!==
r(f,d)?(b("#sellingSaleDate").addClass("error"),b(".error-msg-sell-date").show(),c=!1):"no"===r(e,d)&&(b("#sellingSaleDate").addClass("error"),b(".error-msg-working-day").show(),c=!1)}return c}function Q(a,b){var c=[];if(a){a=a.split("/");var d=p.parseInt(a[1],10),e=k.indexFromNumber(d),g=(new Date(a[2],e,a[0])).getTime();a=n.data("payment-details");jQuery.each(a,function(a,f){if(a=f.recordDate){a=a.split(" ");var e=k.indexFromName(a[1]);0<e&&0<d&&(a=(new Date(a[2],e,a[0])).getTime(),g<=a&&c.push({paymentDate:f.paymentDate,
amount:f.interestPayment*b}))}})}return c}function R(a,b,f){var c=[];if(a){a=a.split("/");var d=p.parseInt(a[1],10),g=k.indexFromNumber(d),q=(new Date(a[2],g,a[0])).getTime();a=n.data("payment-details");jQuery.each(a,function(a,e){if(e.recordDate){var g=e.recordDate.split(" ");a=f.split("/");var h=k.indexFromName(g[1]);0<h&&0<d&&0<a[0]&&(g=(new Date(g[2],h,g[0])).getTime(),h=p.parseInt(a[1],10),h=k.indexFromNumber(h),a=(new Date(a[2],h,a[0])).getTime(),q<=g&&a>=g&&c.push({paymentDate:e.paymentDate,
amount:e.interestPayment*b}))}})}return c}function S(a,b){var c,d=n.data("payment-details");jQuery.each(d,function(d,f){if(f.recordDate&&a){d=f.recordDate.split(" ");var e=k.indexFromName(d[1]);d=(new Date(d[2],e,d[0])).getTime();e=a.split("/");var g=p.parseInt(e[1],10);g=k.indexFromNumber(g);e=(new Date(e[2],g,e[0])).getTime();g=f.paymentDate.split(" ");var h=k.indexFromName(g[1]);g=(new Date(g[2],h,g[0])).getTime();h=b.split(" ");var l=k.indexFromName(h[1]);h=(new Date(h[2],l,h[0])).getTime();e>
d&&(e<=g||h<=g)&&(c=f.paymentDate)}return!0});return c}function T(a){a=S(x(d[a+"PurchaseDate"]),d[a+"PurchaseDate"]);v.find(".tooltip-detail").hide();a?(v.find(".verify-coupon").show(),v.find(".coupon-entitle-date").text(a)):v.find(".verify-coupon").hide()}function L(a){b("#"+a+"ingCashFlow").find("li").eq(1).nextAll().remove();b("#"+a+"ingCashFlow").hide();var c="buy"===a?Q(x(d.buyPurchaseDate),d.buyNumberOfLots):R(x(d.sellPurchaseDate),d.sellNumberOfLots,x(d.sellSaleDate));var f=0;u.forEach(c,function(b){f+=
parseFloat(b.amount.toFixed(2));var c=document.getElementById(a+"ingCashFlow");c&&U.append(c,["",["li",b.paymentDate],["li",b.amount.toFixed(2)]])});0<c.length&&b("#"+a+"ingCashFlow").show();d[a+"TotalCouponPayment"]=f;T(a)}function V(){m.show();var a=z(d.buyPurchaseDate);a="bondYear\x3d"+n.data("bond-year")+"\x26buy_date\x3d"+a+"\x26buy_price\x3d"+d.buyMarketPrice+"\x26num_shares\x3d"+d.buyNumberOfShares();jQuery.getJSON("/bin/public/temasek-corporate/bond_calculator.json?"+a).done(function(a){var c=
parseFloat(d.buyMarketPrice)*d.buyNumberOfShares(),h=parseFloat(d.buyTotalCouponPayment)+d.buyNumberOfShares(),e=h-c;b("#buyingTotalAmountPaid").text(l(c.toFixed(2)));b("#buyingYieldToMaturity").text(a["annual xirr"]);b("#buyingTotalAmountReceived").text(l(h.toFixed(2)));b("#buyingTotalCouponPayment").text(l(d.buyTotalCouponPayment.toFixed(2)));0>e?(e=Math.abs(e),b("#buyingTotalExpectedReturns").text("-S$"+l(e.toFixed(2)))):b("#buyingTotalExpectedReturns").text("S$"+l(e.toFixed(2)));b("#buyingCalculatedResult").show();
b("#tabBuying").find(".result-error-msg").hide();b("#bondHashCode").text(a.hmac);b("#bondHashSection").show();m.hide()}).fail(function(a){console.log("error",a);b("#buyingCalculatedResult").hide();b("#tabBuying").find(".result-error-msg").show();b("#bondHashSection").hide();m.hide()})}function E(){return"t2026"===n.data("bond-year")?new Date(2021,t.Month.NOVEMBER,25):new Date(2018,t.Month.OCTOBER,26)}function F(){return"t2026"===n.data("bond-year")?new Date(2026,t.Month.NOVEMBER,24):new Date(2023,
t.Month.OCTOBER,25)}function W(){m.show();var a=z(d.sellPurchaseDate),c=z(d.sellSaleDate);a="bondYear\x3d"+n.data("bond-year")+"\x26buy_date\x3d"+a+"\x26buy_price\x3d"+d.sellPurchasePricePerLot+"\x26num_shares\x3d"+d.sellNumberOfShares()+"\x26sell_date\x3d"+c+"\x26sell_price\x3d"+d.sellPricePerLot;jQuery.getJSON("/bin/public/temasek-corporate/bond_calculator.json?"+a).done(function(a){var c=parseFloat(d.sellPurchasePricePerLot)*d.sellNumberOfShares(),f=parseFloat(d.sellTotalCouponPayment)+d.sellNumberOfShares()*
d.sellPricePerLot,g=f-c;b("#sellingingTotalAmountPaid").text(l(c.toFixed(2)));b("#sellingRateOfReturn").text(a["annual xirr"]);b("#sellingTotalAmountReceived").text(l(f.toFixed(2)));b("#sellingTotalCouponPayment").text(l(d.sellTotalCouponPayment.toFixed(2)));0>g?(g=Math.abs(g),b("#sellingTotalReturns").text("-S$"+l(g.toFixed(2)))):b("#sellingTotalReturns").text("S$"+l(g.toFixed(2)));b("#sellingCalculatedResult").show();b("#tabSelling").find(".result-error-msg").hide();b("#bondHashCode").text(a.hmac);
b("#bondHashSection").show();m.hide()}).fail(function(a){console.log("error",a);b("#sellingCalculatedResult").hide();b("#tabSelling").find(".result-error-msg").show();b("#bondHashSection").hide();m.hide()})}var X=blacksunplc.objects,p=blacksunplc.numbers,u=blacksunplc.arrays,J=blacksunplc.strings,t=blacksunplc.dates,U=blacksunplc.jsonml,k;(function(){var a="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),b={indexFromNumber:function(a){return a-1},numberFromIndex:function(a){return a+1},
indexFromName:function(b){return u.indexOf(a,b)},nameFromNumber:function(c){return a[b.indexFromNumber(c)]},numberFromName:function(a){return b.numberFromIndex(b.indexFromName(a))}};k=X.freeze(b)})();var d={bondInfo:null,lotsPriceDefault:1E3,buyPriceDefault:0,buyPurchaseDate:null,buyNumberOfLots:0,buyMarketPrice:0,buyTotalCouponPayment:0,buyNumberOfShares:function(){return parseFloat(this.lotsPriceDefault)*parseFloat(this.buyNumberOfLots)},sellPriceDefault:0,sellPurchaseDate:null,sellNumberOfLots:0,
sellPurchasePricePerLot:0,sellSaleDate:null,sellPricePerLot:0,sellTotalCouponPayment:0,sellNumberOfShares:function(){return parseFloat(this.lotsPriceDefault)*parseFloat(this.sellNumberOfLots)}},v=b(".bond-tabbed-content-items .result-content"),n=b(".bond-tabbed-content-tabs"),H=n.data("holiday-details"),m=b(".spinner-holder"),I;(function(){var a=b("#chartConfig").data("bond-year");jQuery.get("/bin/public/temasek-corporate/historical_price.csv?bondYear\x3d"+a+"\x26date_start\x3d20181026").done(function(a){I=
N(a)})})();(function(){var a=new Date;a.setHours(0,0,0,0);b("#buyingPurchaseDate").datepicker({dateFormat:"dd M yyyy",maxDate:F(),minDate:E(),onSelect:function(c){""!==c&&(b("#buyingPurchaseDate").addClass("has-value"),"true"!==b("#buyingMarketPrice").attr("data-is-dirty")&&(c=new Date(c),"same"===r(a,c)?B("#tabBuying","buyingMarketPrice"):"no"===r(a,c)?C("buyingPurchaseDate","buyingMarketPrice"):(b("#buyingMarketPrice").val("").removeClass("has-value"),w("buyingMarketPrice"))))},onRenderCell:function(a,
b){if("day"===b)return{disabled:D(a)}}});b("#sellingPurchaseDate").datepicker({dateFormat:"dd M yyyy",position:"bottom right",maxDate:F(),minDate:E(),onSelect:function(c){""!==c&&(b("#sellingPurchaseDate").addClass("has-value"),"true"!==b("#sellingPurchasePricePerLot").attr("data-is-dirty")&&(c=new Date(c),"same"===r(a,c)?B("#tabSelling","sellingPurchasePricePerLot"):"no"===r(a,c)?C("sellingPurchaseDate","sellingPurchasePricePerLot"):(b("#sellingPurchasePricePerLot").val("").removeClass("has-value"),
w("sellingPurchasePricePerLot"))))},onRenderCell:function(a,b){if("day"===b)return{disabled:D(a)}}});b("#sellingSaleDate").datepicker({dateFormat:"dd M yyyy",position:"bottom right",minDate:E(),maxDate:F(),onSelect:function(c){""!==c&&(b("#sellingSaleDate").addClass("has-value"),"true"!==b("#sellingSellPricePerLot").attr("data-is-dirty")&&(c=new Date(c),"same"===r(a,c)?B("#tabSelling","sellingSellPricePerLot"):"no"===r(a,c)?C("sellingSaleDate","sellingSellPricePerLot"):(b("#sellingSellPricePerLot").val("").removeClass("has-value"),
w("sellingSellPricePerLot"))))},onRenderCell:function(a,b){if("day"===b)return{disabled:D(a)}}})})();b(".bond-tabbed-content-items input").on("keyup",function(a){a=b(a.currentTarget);""!==a.val()?a.addClass("has-value"):a.removeClass("has-value")});b("#buyingMarketPrice, #sellingPurchasePricePerLot, #sellingSellPricePerLot").on("keyup",function(a){a=b(a.currentTarget);""!==a.val()?(a.attr("data-is-dirty",!0),a=a.attr("id"),w(a)):a.attr("data-is-dirty",!1)});b(".bond-tabbed-content-tab a").on("click",
function(a){a.preventDefault();a=b(a.currentTarget);var c=a.attr("href");b(".bond-tabbed-content-tab").removeClass("selected");a.parent().addClass("selected");b(".bond-tabbed-content-data").removeClass("selected");b(c).addClass("selected")});b("form[name\x3d'buyingForm']").on("submit",function(a){K("#tabBuying")?(d.buyPurchaseDate=b("#buyingPurchaseDate").val(),d.buyNumberOfLots=b("#buyingNumberOfLots").val(),d.buyMarketPrice=b("#buyingMarketPrice").val(),L("buy"),V()):b("#buyingCalculatedResult").hide();
a.preventDefault();a.stopPropagation()});b("form[name\x3d'buyingForm']").on("reset",function(){var a=b("#tabBuying");a.find(".error").removeClass("error");a.find("input").removeClass("has-value");b("#buyingMarketPrice").attr("data-is-dirty",!1);a.find(".update-date").hide();a.find(".error-msg").hide()});b("form[name\x3d'sellingForm']").on("submit",function(a){K("#tabSelling")?(d.sellPurchaseDate=b("#sellingPurchaseDate").val(),d.sellNumberOfLots=b("#sellingNumberOfLots").val(),d.sellPurchasePricePerLot=
b("#sellingPurchasePricePerLot").val(),d.sellSaleDate=b("#sellingSaleDate").val(),d.sellPricePerLot=b("#sellingSellPricePerLot").val(),L("sell"),W()):b("#sellingCalculatedResult").hide();a.preventDefault();a.stopPropagation()});b("form[name\x3d'sellingForm']").on("reset",function(){var a=b("#tabSelling");a.find(".error").removeClass("error");a.find("input").removeClass("has-value");b("#sellingPurchasePricePerLot, #sellingSaleDate").attr("data-is-dirty",!1);a.find(".update-date").hide();a.find(".error-msg").hide()});
b(".number-with-decimal").on("keypress keyup blur",function(a){var c=b(a.currentTarget),d=c.val().replace(/[^0-9.]/g,"");c.val(d);c=a.which;(46!==c||J.includes(d,"."))&&(48>c||57<c)&&a.preventDefault()});b(".only-number").on("keypress keyup blur",function(a){var c=b(a.currentTarget),d=c.val().replace(/[^\d].+/,"");c.val(d);c=a.which;(48>c||57<c)&&a.preventDefault()});v.on("click",".tooltip-link",function(a){a.preventDefault();b(a.currentTarget).parents("li").find(".tooltip-detail").show()});v.on("click",
".close",function(a){a.preventDefault();b(a.currentTarget).parents(".tooltip-detail").hide()})});